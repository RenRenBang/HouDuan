<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.soecode.lyf.dao.CorderDao">

	<insert id="addCorder" parameterType="com.soecode.lyf.entity.Corder">
		insert into corder(
			type,
			trade,
			start_time,
			end_time,
			title,
			money,
			odescribe,
			ophoto_path,
			address,
			ocount,
			is_valid,
			uid
		)value(
			#{type},
			#{trade},
			now(),
			#{endTime},
			#{title},
			#{money},
			#{odescribe},
			#{ophotoPath},
			#{address},
			#{ocount},
			#{isValid},
			#{cuser.uid}
		)
	</insert>
	
	
	<select id = "queryCorderBy" resultType="com.soecode.lyf.entity.Corder">
		select *
        from corder
        where 1=1  
        <if test="type != '' and type != null">  
            and type=#{type}  
        </if>  
        <if test="trade != '' and trade != null">  
            and trade=#{trade}  
        </if>  
        <if test="title != '' and title != null">  
            and title like CONCAT('%', #{title}, '%')
        </if>  
	</select>
	
	<resultMap type="com.soecode.lyf.entity.Corder" id="CorderMap">
		<id column="oid" property="oid"/>
		<result column="type" property="type"/>
		<result column="trade" property="trade"/>
		<result column="end_time" property="endTime"/>
		<result column="title" property="title"/>
		<result column="money" property="money"/>
		<result column="odescribe" property="odescribe"/>
		<result column="ophoto_path" property="ophotoPath"/>
		<result column="address" property="address"/>
		<result column="ocount" property="ocount"/>
		<result column="is_valid" property="isValid"/>
		<result column="gm_num" property="gmNum"/>
		<result column="coll_num" property="collNum"/>
		<association property="cuser" column="cuser.uid" javaType="com.soecode.lyf.entity.Cuser">
			<id column="uid" property="uid"/>
			<result column="uphone" property="uphone"/> 
			<result column="name" property="name"/>
			<result column="nickname" property="nickname"/>
			<result column="image" property="image"/>
			<result column="profile" property="profile"/>
		</association>
		
		
		<!-- <association property="cuser" select="com.soecode.lyf.entity.Cuser.findByid" column="uid">
			
		</association> -->
	</resultMap>
	<!-- Corder queryCorderById(@Param("oid") int oid);
	
	oid,type,trade,end_time,title,money,odescribe,address,ocount,is_valid -->
	<select id="queryCorderById" resultMap="CorderMap">
		select * from corder,cuser where corder.uid=cuser.uid and oid=#{oid}
	</select>
	
	<delete id="deleteCorderById">
		delete from corder where oid = #{oid}
	</delete>
	
	<update id="updateNum">
		update corder set 
		<if test="num == 'gm_num'">
			gm_num = gm_num+1
		</if>
		<if test="num == 'coll_num'">
			coll_num = coll_num+1
		</if>
		where oid= #{oid}
	</update>
	
	<select id="queryCorderListById" resultType="com.soecode.lyf.entity.Corder">
		select * from corder where uid=#{uid}
	</select>
</mapper>